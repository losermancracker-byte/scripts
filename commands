-- Society Stand Commands - FIXED CLEAN CLOSE + POSITION MEMORY
-- Press E to toggle • Drag by top bar

local UIS = game:GetService("UserInputService")
local TS = game:GetService("TweenService")

local sg = Instance.new("ScreenGui")
sg.Name = "StandCmdsMini"
sg.ResetOnSpawn = false
sg.Parent = game:GetService("CoreGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 60, 0, 60)
frame.Position = UDim2.new(0.5, -30, 0.5, -30)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
frame.BackgroundTransparency = 1
frame.BorderSizePixel = 0
frame.ClipsDescendants = true
frame.Visible = true
frame.Parent = sg

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = frame

local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(80, 80, 240)
stroke.Transparency = 0.7
stroke.Thickness = 1.6
stroke.Parent = frame

-- Title Bar
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 38)
titleBar.BackgroundColor3 = Color3.fromRGB(28, 28, 48)
titleBar.BorderSizePixel = 0
titleBar.Parent = frame

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -90, 1, 0)
titleLabel.Position = UDim2.new(0, 12, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "Commands"
titleLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
titleLabel.TextSize = 18
titleLabel.Font = Enum.Font.GothamSemibold
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = titleBar

local hintLabel = Instance.new("TextLabel")
hintLabel.Size = UDim2.new(0, 80, 1, 0)
hintLabel.Position = UDim2.new(1, -90, 0, 0)
hintLabel.BackgroundTransparency = 1
hintLabel.Text = "[E] toggle"
hintLabel.TextColor3 = Color3.fromRGB(140, 140, 190)
hintLabel.TextSize = 14
hintLabel.Font = Enum.Font.Gotham
hintLabel.TextXAlignment = Enum.TextXAlignment.Right
hintLabel.Parent = titleBar

-- Content area
local content = Instance.new("Frame")
content.Size = UDim2.new(1, 0, 1, -38)
content.Position = UDim2.new(0, 0, 0, 38)
content.BackgroundTransparency = 1
content.ClipsDescendants = true
content.Parent = frame

local scroll = Instance.new("ScrollingFrame")
scroll.Size = UDim2.new(1, -20, 1, -10)
scroll.Position = UDim2.new(0, 10, 0, 5)
scroll.BackgroundTransparency = 1
scroll.ScrollBarThickness = 4
scroll.ScrollBarImageColor3 = Color3.fromRGB(90, 90, 255)
scroll.CanvasSize = UDim2.new(0, 0, 0, 620)
scroll.Parent = content

local layout = Instance.new("UIListLayout")
layout.Padding = UDim.new(0, 8)
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.Parent = scroll

-- Command data (compact)
local sections = {
    {"MAIN", {"summon • vanish • clean", "leave • stop • reset/re", "left • right • back • under"}},
    {"MISC", {"fly [anim] • view/unview", "transfer/revert • say [text]", "rejoin/rj • dog [target]", "frame/lift • fguard • js"}},
    {"FLING", {"fling [target] • sfling/sf", "punch • slam • roof"}},
    {"SUSSY", {"benx • blow • doggy [target]"}},
    {"PARTS (lag)", {"tpua/tpunanchored • crush", "scrush/stopcrush"}}
}

for _, group in ipairs(sections) do
    local header = Instance.new("TextLabel")
    header.Size = UDim2.new(1, 0, 0, 28)
    header.BackgroundColor3 = Color3.fromRGB(35, 35, 55)
    header.BackgroundTransparency = 0.6
    header.Text = "  " .. group[1]
    header.TextColor3 = Color3.fromRGB(170, 170, 255)
    header.TextSize = 17
    header.Font = Enum.Font.GothamSemibold
    header.TextXAlignment = Enum.TextXAlignment.Left
    header.Parent = scroll
    
    local hc = Instance.new("UICorner")
    hc.CornerRadius = UDim.new(0, 7)
    hc.Parent = header

    for _, cmd in ipairs(group[2]) do
        local lbl = Instance.new("TextLabel")
        lbl.Size = UDim2.new(1, 0, 0, 22)
        lbl.BackgroundTransparency = 1
        lbl.Text = "    • " .. cmd
        lbl.TextColor3 = Color3.fromRGB(220, 220, 235)
        lbl.TextSize = 15
        lbl.Font = Enum.Font.Gotham
        lbl.TextXAlignment = Enum.TextXAlignment.Left
        lbl.Parent = scroll
    end
end

-- Dragging
local dragging, dragInput, dragStart, startPos

titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = frame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)

titleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UIS.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Toggle with reliable clean open/close
local isOpen = false

local function toggle()
    isOpen = not isOpen
    
    if isOpen then
        -- Reset visibility & transparency
        content.Visible = true
        titleBar.BackgroundTransparency = 0
        titleLabel.TextTransparency = 0
        hintLabel.TextTransparency = 0
        
        -- Animate open from current position
        TS:Create(frame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, 320, 0, 400),
            BackgroundTransparency = 0.18
        }):Play()
    else
        -- Close cleanly: fade content first
        content.Visible = false
        
        -- Quick fade on title
        TS:Create(titleBar, TweenInfo.new(0.2), {BackgroundTransparency = 1}):Play()
        TS:Create(titleLabel, TweenInfo.new(0.2), {TextTransparency = 1}):Play()
        TS:Create(hintLabel, TweenInfo.new(0.2), {TextTransparency = 1}):Play()
        
        -- Then shrink frame
        task.delay(0.15, function()
            TS:Create(frame, TweenInfo.new(0.35, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
                Size = UDim2.new(0, 50, 0, 50),
                BackgroundTransparency = 1
            }):Play()
        end)
    end
end

-- Auto open on execute with animation
task.delay(0.15, toggle)

-- E key toggle
UIS.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == Enum.KeyCode.E then
        toggle()
    end
end)

print("UI should now open/close cleanly • Position saved • Texts always return")
